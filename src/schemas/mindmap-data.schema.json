{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://mindmap-tool.example.com/schemas/mindmap-data.json",
  "title": "マインドマップデータスキーマ",
  "description": "マインドマップアプリケーションで使用されるデータ構造のJSON Schema",
  "type": "object",
  "required": ["version", "title", "root"],
  "properties": {
    "version": {
      "type": "string",
      "description": "データ形式のバージョン",
      "pattern": "^\\d+\\.\\d+(\\.\\d+)?$",
      "examples": ["1.0", "1.0.0"]
    },
    "title": {
      "type": "string",
      "description": "マインドマップのタイトル",
      "minLength": 1,
      "maxLength": 200
    },
    "description": {
      "type": "string",
      "description": "マインドマップの説明",
      "maxLength": 1000
    },
    "author": {
      "type": "string",
      "description": "作成者",
      "maxLength": 100
    },
    "createdAt": {
      "type": "string",
      "description": "作成日時",
      "format": "date-time"
    },
    "updatedAt": {
      "type": "string",
      "description": "更新日時",
      "format": "date-time"
    },
    "root": {
      "$ref": "#/definitions/MindmapNode",
      "description": "ルートノード"
    },
    "schema": {
      "$ref": "#/definitions/CustomSchema",
      "description": "カスタムスキーマ定義"
    },
    "settings": {
      "$ref": "#/definitions/MindmapSettings",
      "description": "表示設定"
    },
    "metadata": {
      "type": "object",
      "description": "追加のメタデータ",
      "additionalProperties": true
    }
  },
  "additionalProperties": false,
  "definitions": {
    "MindmapNode": {
      "type": "object",
      "required": ["id", "title"],
      "properties": {
        "id": {
          "type": "string",
          "description": "ノードの一意識別子",
          "minLength": 1,
          "maxLength": 100,
          "pattern": "^[a-zA-Z0-9_-]+$"
        },
        "title": {
          "type": "string",
          "description": "ノードのタイトル",
          "minLength": 1,
          "maxLength": 200
        },
        "description": {
          "type": "string",
          "description": "ノードの詳細説明",
          "maxLength": 2000
        },
        "type": {
          "type": "string",
          "description": "ノードの種類",
          "maxLength": 50
        },
        "color": {
          "type": "string",
          "description": "ノードの色",
          "pattern": "^#[0-9a-fA-F]{6}$|^[a-zA-Z]+$"
        },
        "icon": {
          "type": "string",
          "description": "ノードのアイコン",
          "maxLength": 50
        },
        "priority": {
          "type": "string",
          "description": "ノードの優先度",
          "enum": ["high", "medium", "low"]
        },
        "status": {
          "type": "string",
          "description": "ノードのステータス",
          "enum": ["todo", "in-progress", "done", "blocked"]
        },
        "assignee": {
          "type": "string",
          "description": "担当者",
          "maxLength": 100
        },
        "deadline": {
          "type": "string",
          "description": "期限",
          "format": "date"
        },
        "createdAt": {
          "type": "string",
          "description": "作成日時",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "更新日時",
          "format": "date-time"
        },
        "tags": {
          "type": "array",
          "description": "タグ",
          "items": {
            "type": "string",
            "maxLength": 50
          },
          "uniqueItems": true,
          "maxItems": 20
        },
        "links": {
          "type": "array",
          "description": "関連リンク",
          "items": {
            "type": "object",
            "required": ["url", "title"],
            "properties": {
              "url": {
                "type": "string",
                "format": "uri",
                "description": "リンクURL"
              },
              "title": {
                "type": "string",
                "description": "リンクタイトル",
                "minLength": 1,
                "maxLength": 100
              },
              "type": {
                "type": "string",
                "description": "リンクの種類",
                "enum": ["reference", "documentation", "issue", "other"]
              }
            },
            "additionalProperties": false
          },
          "maxItems": 10
        },
        "position": {
          "type": "object",
          "description": "ノードの表示位置",
          "required": ["x", "y"],
          "properties": {
            "x": {
              "type": "number",
              "description": "X座標"
            },
            "y": {
              "type": "number",
              "description": "Y座標"
            }
          },
          "additionalProperties": false
        },
        "collapsed": {
          "type": "boolean",
          "description": "折りたたみ状態",
          "default": false
        },
        "metadata": {
          "type": "object",
          "description": "拡張可能なメタデータ",
          "additionalProperties": true
        },
        "customFields": {
          "type": "object",
          "description": "カスタムフィールドの値",
          "additionalProperties": true
        },
        "children": {
          "type": "array",
          "description": "子ノードの配列",
          "items": {
            "$ref": "#/definitions/MindmapNode"
          },
          "maxItems": 1000
        }
      },
      "additionalProperties": false
    },
    "CustomSchema": {
      "type": "object",
      "required": ["fields", "displayRules"],
      "properties": {
        "version": {
          "type": "string",
          "description": "スキーマのバージョン",
          "pattern": "^\\d+\\.\\d+(\\.\\d+)?$"
        },
        "description": {
          "type": "string",
          "description": "スキーマの説明",
          "maxLength": 500
        },
        "createdAt": {
          "type": "string",
          "description": "作成日時",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "更新日時",
          "format": "date-time"
        },
        "fields": {
          "type": "array",
          "description": "フィールド定義の配列",
          "items": {
            "$ref": "#/definitions/FieldDefinition"
          },
          "maxItems": 50
        },
        "displayRules": {
          "type": "array",
          "description": "表示ルールの配列",
          "items": {
            "$ref": "#/definitions/DisplayRule"
          },
          "maxItems": 100
        }
      },
      "additionalProperties": false
    },
    "FieldDefinition": {
      "type": "object",
      "required": ["name", "type", "label"],
      "properties": {
        "name": {
          "type": "string",
          "description": "フィールド名",
          "minLength": 1,
          "maxLength": 50,
          "pattern": "^[a-zA-Z][a-zA-Z0-9_]*$"
        },
        "type": {
          "type": "string",
          "description": "フィールドの型",
          "enum": ["string", "number", "boolean", "date", "select", "multiselect"]
        },
        "label": {
          "type": "string",
          "description": "表示用ラベル",
          "minLength": 1,
          "maxLength": 100
        },
        "description": {
          "type": "string",
          "description": "フィールドの説明",
          "maxLength": 200
        },
        "required": {
          "type": "boolean",
          "description": "必須フィールドかどうか",
          "default": false
        },
        "defaultValue": {
          "description": "デフォルト値"
        },
        "options": {
          "type": "array",
          "description": "select/multiselect用の選択肢",
          "items": {
            "type": "string",
            "maxLength": 100
          },
          "uniqueItems": true,
          "maxItems": 100
        },
        "validation": {
          "type": "array",
          "description": "バリデーションルール",
          "items": {
            "$ref": "#/definitions/ValidationRule"
          },
          "maxItems": 10
        }
      },
      "additionalProperties": false
    },
    "ValidationRule": {
      "type": "object",
      "required": ["type"],
      "properties": {
        "type": {
          "type": "string",
          "description": "バリデーションの種類",
          "enum": ["required", "minLength", "maxLength", "pattern", "min", "max"]
        },
        "value": {
          "description": "バリデーション値"
        },
        "message": {
          "type": "string",
          "description": "エラーメッセージ",
          "maxLength": 200
        }
      },
      "additionalProperties": false
    },
    "DisplayRule": {
      "type": "object",
      "required": ["field", "displayType"],
      "properties": {
        "field": {
          "type": "string",
          "description": "対象フィールド名",
          "minLength": 1,
          "maxLength": 50
        },
        "displayType": {
          "type": "string",
          "description": "表示タイプ",
          "enum": ["badge", "icon", "color", "text"]
        },
        "condition": {
          "type": "string",
          "description": "表示条件",
          "maxLength": 200
        },
        "position": {
          "type": "string",
          "description": "表示位置",
          "enum": ["inline", "tooltip", "sidebar"]
        },
        "style": {
          "type": "object",
          "description": "スタイル設定",
          "additionalProperties": true
        }
      },
      "additionalProperties": false
    },
    "MindmapSettings": {
      "type": "object",
      "properties": {
        "theme": {
          "type": "string",
          "description": "テーマ",
          "enum": ["light", "dark", "auto"],
          "default": "light"
        },
        "layout": {
          "type": "string",
          "description": "レイアウト",
          "enum": ["tree", "radial", "force"],
          "default": "tree"
        },
        "zoom": {
          "type": "number",
          "description": "ズームレベル",
          "minimum": 0.1,
          "maximum": 5.0,
          "default": 1.0
        },
        "center": {
          "type": "object",
          "description": "中心位置",
          "required": ["x", "y"],
          "properties": {
            "x": {
              "type": "number",
              "description": "X座標"
            },
            "y": {
              "type": "number",
              "description": "Y座標"
            }
          },
          "additionalProperties": false
        },
        "maxNodeWidth": {
          "type": "number",
          "description": "ノードの最大幅",
          "minimum": 50,
          "maximum": 500,
          "default": 200
        },
        "nodeSpacing": {
          "type": "number",
          "description": "ノード間の間隔",
          "minimum": 10,
          "maximum": 100,
          "default": 30
        },
        "levelSpacing": {
          "type": "number",
          "description": "レベル間の間隔",
          "minimum": 50,
          "maximum": 300,
          "default": 100
        },
        "enableAnimation": {
          "type": "boolean",
          "description": "アニメーション有効/無効",
          "default": true
        },
        "autoLayout": {
          "type": "boolean",
          "description": "自動レイアウト有効/無効",
          "default": true
        }
      },
      "additionalProperties": false
    }
  }
}